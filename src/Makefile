#******************************************************************************#
#* src/Makefile                                                               *#
#*                                                                 2018/12/09 *#
#* Copyright (C) 2018 Mochi.                                                  *#
#******************************************************************************#
#******************************************************************************#
#* 定義                                                                       *#
#******************************************************************************#
# バイナリ名
LIB_NAME = libMLib.a

# ソースコード
SRCS = List/ListGet.c    \
       List/ListInit.c   \
       List/ListInsert.c \
       List/ListRemove.c

# オブジェクトファイル生成先
OBJ_DIR = ../build/obj

# Cフラグ
CFLAGS = -O               \
         -Wall            \
         -masm=intel      \
         -m32             \
         -ffreestanding   \
         -Iinclude/


#******************************************************************************#
#* マクロ                                                                     *#
#******************************************************************************#
# オブジェクトサブディレクトリ
OBJ_SUBDIRS = $(sort $(addprefix $(OBJ_DIR)/, $(dir $(SRCS))))

# オブジェクトファイル
OBJS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.o))

# 依存関係ファイル
DEPS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.d))


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
.PHONY: all
all: $(OBJ_SUBDIRS) $(OBJS) $(OBJ_DIR)/../$(LIB_NAME) Makefile

.PHONY: clean
clean:
	-rm -rf $(OBJ_DIR)/../$(LIB_NAME) $(OBJ_DIR)


#******************************************************************************#
#* 生成規則                                                                   *#
#******************************************************************************#
# 依存関係
-include $(DEPS)

ifdef OBJ_SUBDIRS 
$(OBJ_SUBDIRS):
	mkdir -p $@
endif

# バイナリ
$(OBJ_DIR)/../$(LIB_NAME): $(OBJS) Makefile
	$(AR) rcs $@ $(OBJS)

# アセンブラファイルコンパイル
$(OBJ_DIR)/%.o: %.s Makefile
	$(AS) -o $@ $<

# Cファイルコンパイル
$(OBJ_DIR)/%.o: %.c Makefile
	$(CC) $(CFLAGS) -o $@ -c $< -MD -MP


#******************************************************************************#
