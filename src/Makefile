#******************************************************************************#
#* src/Makefile                                                               *#
#*                                                                 2019/01/06 *#
#* Copyright (C) 2018-2019 Mochi.                                             *#
#******************************************************************************#
#******************************************************************************#
#* 設定                                                                       *#
#******************************************************************************#
# ライブラリ
LIB = libMLib.a

# ソースコード
SRCS = List/ListGet.c    \
       List/ListInit.c   \
       List/ListInsert.c \
       List/ListRemove.c \
       Split/SplitGet.c  \
       Split/SplitInit.c \
       Split/SplitTerm.c

# ビルドディレクトリ
BUILD_DIR = ../build
# オブジェクトディレクトリ
OBJ_DIR   = $(BUILD_DIR)/obj

# Cフラグ
CFLAGS  = -O                 \
          -Wall              \
          -masm=intel        \
          -m32               \
          -ffreestanding     \
          -Iinclude/


#******************************************************************************#
#* 定義                                                                       *#
#******************************************************************************#
# オブジェクトサブディレクトリ
OBJ_SUBDIRS = $(sort $(addprefix $(OBJ_DIR)/, $(dir $(SRCS))))

# オブジェクトファイル
OBJS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.o))

# 依存関係ファイル
DEPS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.d))

# インクルードディレクトリ
CFLAGS  += -I$(BUILD_DIR)/include


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
.PHONY: all
all: $(OBJ_SUBDIRS) $(OBJS) $(OBJ_DIR)/../$(LIB) Makefile

.PHONY: clean
clean:
	-rm -rf $(OBJ_DIR)/../$(LIB) $(OBJ_DIR)


#******************************************************************************#
#* 生成規則                                                                   *#
#******************************************************************************#
# 依存関係
-include $(DEPS)

ifdef OBJ_SUBDIRS 
$(OBJ_SUBDIRS):
	mkdir -p $@
endif

# バイナリ
$(OBJ_DIR)/../$(LIB): $(OBJS) Makefile
	$(AR) rcs $@ $(OBJS)

# アセンブラファイルコンパイル
$(OBJ_DIR)/%.o: %.s Makefile
	$(AS) -o $@ $<

# Cファイルコンパイル
$(OBJ_DIR)/%.o: %.c Makefile
	$(CC) $(CFLAGS) -o $@ -c $< -MD -MP


#******************************************************************************#
